#!/bin/sh

app="floating-dials"
APPNAME="Floating Dials"
MAJOR="2"
MINOR="0"
REV="0"

VERSION="$MAJOR.$MINOR.$REV"
VERSIONCODE=`expr "$MAJOR" '*' '10000' '+' "$MINOR" '*' '100' '+' "$REV"`
config="src/config.h"

if [ "$#" = 0 ] 
then
    set - "main" "test" "24h" 
fi

for f
do
    echo "// generated by make-all -- do not edit" > "$config"
    echo "#define VERSION \"$VERSION\"" >> "$config"
    echo "#define VERSIONCODE $VERSIONCODE" >> "$config"
    SHORTNAME="$APPNAME $f"
    case "$f" in
	"main")
	    SHORTNAME="$APPNAME"
	    ;;
	"test")
	    echo "#define TEST" >> "$config"
	    ;;
	"24h")
	    echo "#define TWENTYFOUR true" >> "$config"
	    ;;
    esac

    echo "#define SHORTNAME \"$SHORTNAME\"" >> "$config"
    echo "#define LONGNAME \"$SHORTNAME $VERSION\"" >> "$config"
    cpp appinfo.json.cpp |grep -v '^#' > appinfo.json
    pebble build && mv "build/$app.pbw" "build/$app-$f-$VERSION.pbw"
done
