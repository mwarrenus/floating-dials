#!/bin/sh

app="floating-dials"
VERSION="2.0.0"
VERSIONCODE="20000"

config="src/config.h"

if [ "$#" = 0 ] 
then
    set - "main" "test" "24h" 
fi

for f
do
    echo "// generated by make-all -- do not edit" > "$config"
    echo "#define VERSION \"$VERSION\"" >> "$config"
    echo "#define VERSIONCODE $VERSIONCODE" >> "$config"
    case "$f" in
	"main")
	    ;;
	"test")
	    echo "#define TEST" >> "$config"
	    ;;
	"24h")
	    echo "#define TWENTYFOUR true" >> "$config"
	    ;;
    esac
    cpp appinfo.json.cpp |grep -v '^#' > appinfo.json
    pebble build && mv "build/$app.pbw" "build/$app-$f-$VERSION.pbw"
done
