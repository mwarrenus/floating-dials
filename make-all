#!/bin/sh

# edit this:
APP="floating-dials"
APPNAME="Floating Dials"
MAJOR="2"
MINOR="8"
REV="0"

if [ "$#" = 0 ] 
then
    # edit this: 
    set - "pro" 
fi

config="src/config.h"
for f
do
    echo "// config for $f" > "$config"
    echo "// generated by make-all -- do not edit" >> "$config"

    case "$f" in
    # edit this:
	"pro")
	    UUID="a713c701-7bb1-4e19-9bef-5af215d6fc54"
	    shortname="$APPNAME Pro"
	    echo '#define CONFIGURABLE "capabilities": [ "configurable" ],' >> "$config"
	    ;;
	"free")
	    UUID="a713c701-7bb1-4e19-9bef-5af215d6fc51"
	    shortname="$APPNAME Free"
	    echo '#define CONFIGURABLE' >> "$config"
	    ;;
    esac

    version="$MAJOR.$MINOR.$REV"
    versioncode=`expr "$MAJOR" '*' '10000' '+' "$MINOR" '*' '100' '+' "$REV"`
    echo "#define UUID \"$UUID\"" >> "$config"
    echo "#define VERSION \"$version\"" >> "$config"
    echo "#define VERSIONCODE $versioncode" >> "$config"
    echo "#define SHORTNAME \"$shortname\"" >> "$config"
    echo "#define LONGNAME \"$shortname $version\"" >> "$config"
    cpp appinfo.json.cpp | grep -v '^#' > appinfo.json

    if [ "$f" = "free" ]
    then
	rm wscript wtools 
	ln -s wscript.orig wscript
	cp build/autoconfig.c build/autoconfig.h src
	pebble clean
    fi

    pebble build && cp "build/$APP.pbw" "tmp/$APP-$f-$version.pbw"

    if [ "$f" = "free" ]
    then
	rm wscript 
	ln -s wscript.autoconfig wscript
	ln -s wtools.autoconfig wtools
	rm src/autoconfig.c src/autoconfig.h
	pebble clean
    fi

done



