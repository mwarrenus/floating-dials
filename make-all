#!/bin/sh

# edit this:
APP="floating-dials"
APPNAME="Floating Dials"
MAJOR="2"
MINOR="0"
REV="0"

if [ "$#" = 0 ] 
then
    # edit this: 
    set - "main" "24h" "test" 
fi

config="src/config.h"
for f
do
    echo "// config for $f" > "$config"
    echo "// generated by make-all -- do not edit" >> "$config"

    case "$f" in
    # edit this:
	"main")
	    UUID="a713c701-7bb1-4e19-9bef-5af215d6fc51"
	    ;;

	"24h")
	    UUID="a713c701-7bb1-4e19-9bef-5af215d6fc52"
	    echo "#define TWENTYFOUR true" >> "$config"
	    ;;
	"test")
	    UUID="a713c701-7bb1-4e19-9bef-5af215d6fc53"
	    echo "#define TEST" >> "$config"
	    ;;    
    esac

    if [ "$f" = "main" ]
    then
	shortname="$APPNAME"
    else
	shortname="$APPNAME $f"
    fi
    version="$MAJOR.$MINOR.$REV"
    versioncode=`expr "$MAJOR" '*' '10000' '+' "$MINOR" '*' '100' '+' "$REV"`
    echo "#define UUID \"$UUID\"" >> "$config"
    echo "#define VERSION \"$version\"" >> "$config"
    echo "#define VERSIONCODE $versioncode" >> "$config"
    echo "#define ICON \"images/$APP-$f-icon.png\"" >> "$config"
    echo "#define SHORTNAME \"$shortname\"" >> "$config"
    echo "#define LONGNAME \"$shortname $version\"" >> "$config"
    cpp appinfo.json.cpp | grep -v '^#' > appinfo.json
    pebble build && mv "build/$APP.pbw" "build/$APP-$f-$version.pbw"
done
