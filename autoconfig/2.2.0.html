<!DOCTYPE html>
<html>
<head>
	<title>Floating Dials</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/git/jquery.mobile-git.min.css">
	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	<script src="http://code.jquery.com/mobile/git/jquery.mobile-git.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
</head>

<body>
	<div data-role="page" id="configuration">
		<div data-role="header" id="header">
			<button id="b-cancel" data-icon="back" data-iconpos="left" data-inline="true" data-mini="true">Cancel</button>
			<h1>Floating Dials 2.1.0</h1>
		</div>
		<div data-role="content">
			<form id="configuration-form">
				<div class="ui-field-contain">
				<label for="background">Background Colour</label>
				<select name="background" id="background" data-role="slider">
					<option value="0">Black</option>
					<option value="1">White</option>
				</select>
				</div><div class="ui-field-contain">
				<label for="hourdialtype">Hour Dial Type</label>
				<select name="hourdialtype" id="hourdialtype" data-role="slider">
					<option value="0">12h</option>
					<option value="1">24h</option>
				</select>
				</div>
				
				<button id="b-submit" data-theme="b" data-icon="check" data-iconpos="right">Save</button>
			</form>
		</div>
	</div>
	<script type="text/javascript">	 
		$().ready(function() {	  
			var dictionary;
			try {
				dictionary = JSON.parse(localStorage['Floating Dials']);
			}
			catch(e) {
				dictionary = {
					"background" : "0",
					"hourdialtype" : "0",
					
				};
			}

			if(dictionary['background']) {
				$('#background').val(dictionary['background'].toString()).slider('refresh');
			}
			if(dictionary['hourdialtype']) {
				$('#hourdialtype').val(dictionary['hourdialtype'].toString()).slider('refresh');
			}
			
		});
		
		// Handle different UI on i-devices
		if( /iPhone|iPad|iPod/i.test(navigator.userAgent) ) {
			$("#header").remove();
		}
		
		$("form :input").on("keypress", function(e) {
			return e.keyCode != 13;
		});
		
		$("#configuration-form").validate({
			rules: {
				
				
			},
			errorPlacement: function(error, element) {
				error.insertAfter( element.parent() );
			}
		});

		$('#b-submit').click(function() {
			if (!$("#configuration-form").valid()) {
				return false;
			}
			var dictionary = {};
			{
			var field=document.getElementById('background');
			
			dictionary['background'] = parseInt(field.value);
			
			}
			{
			var field=document.getElementById('hourdialtype');
			
			dictionary['hourdialtype'] = parseInt(field.value);
			
			}
			
			localStorage['Floating Dials'] = JSON.stringify(dictionary);

			var location = "pebblejs://close#" + encodeURIComponent(localStorage['Floating Dials']);
			window.location.href = location;
		});
	
		$('#b-cancel').click(function() {
			var location = "pebblejs://close#";
			window.location.href = location;
		});
	</script>
</body>
</html>
